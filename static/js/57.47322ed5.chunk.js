"use strict";(self.webpackChunkexcel_viewer=self.webpackChunkexcel_viewer||[]).push([[57],{7057:(e,t,s)=>{s.d(t,{DataAnalysis:()=>j});var n=s(9950),l=s(2056),a=s(7094),r=s(1988),i=s(6483),o=s(8864),c=s(4571),d=s(5621),u=s(4525),h=s(5369),y=s(5376),m=s(1598),p=s(7866);class g{static analyzeWorksheet(e){const t=Date.now();try{if(!e||!e.data)throw new Error("\u5de5\u4f5c\u8868\u6570\u636e\u65e0\u6548");if(0===e.rowCount||0===e.colCount)throw new Error("\u5de5\u4f5c\u8868\u4e3a\u7a7a");if(e.rowCount*e.colCount>1e6)throw new Error("\u6570\u636e\u91cf\u8fc7\u5927\uff0c\u8d85\u8fc7100\u4e07\u5355\u5143\u683c\u9650\u5236");const s=this.analyzeDataQuality(e),n=this.analyzeRows(e),l=this.analyzeColumns(e);return{quality:s,rows:n,columns:l,correlations:this.calculateCorrelations(e),generatedAt:new Date,processingTime:Date.now()-t}}catch(s){const n=s instanceof Error?s.message:"\u5206\u6790\u8fc7\u7a0b\u4e2d\u53d1\u751f\u672a\u77e5\u9519\u8bef";return{quality:{score:0,issues:[{type:"inconsistent",severity:"high",message:"\u5206\u6790\u5931\u8d25: ".concat(n),location:{}}],summary:{totalRows:e.rowCount,totalCols:e.colCount,emptyCells:0,duplicateRows:0,inconsistentTypes:0}},rows:[],columns:[],generatedAt:new Date,processingTime:Date.now()-t}}}static analyzeDataQuality(e){const t=[];let s=0,n=0,l=0;for(let u=0;u<e.data.length;u++)for(let n=0;n<e.data[u].length;n++){const l=e.data[u][n];"empty"!==l.type&&""!==l.value||(s++,s<=10&&t.push({type:"empty",severity:"medium",message:"\u7a7a\u503c\u4f4d\u4e8e ".concat(l.address),location:{row:l.row,col:l.col}}))}const a=new Map;for(let u=0;u<e.data.length;u++){const t=e.data[u],s=this.hashRow(t);a.has(s)?(a.get(s).push(u),n++):a.set(s,[u])}for(let u=0;u<e.colCount;u++){const s=new Set;for(let t=0;t<e.data.length;t++){const n=e.data[t][u];"empty"!==n.type&&s.add(n.type)}var r;if(s.size>1)l++,t.push({type:"inconsistent",severity:"high",message:"\u5217 ".concat(null===(r=e.headers)||void 0===r?void 0:r[u]," \u5305\u542b\u591a\u79cd\u6570\u636e\u7c7b\u578b"),location:{col:u},suggestion:"\u5efa\u8bae\u7edf\u4e00\u6570\u636e\u7c7b\u578b"})}const i=s/(e.rowCount*e.colCount),o=n/e.rowCount,c=l/e.colCount,d=Math.max(0,100-(30*i+40*o+30*c));return{score:Math.round(d),issues:t,summary:{totalRows:e.rowCount,totalCols:e.colCount,emptyCells:s,duplicateRows:n,inconsistentTypes:l}}}static analyzeRows(e){const t=[];for(let s=0;s<e.data.length;s++){const n=e.data[s],l=this.analyzeRow(n,s);t.push(l)}return t}static analyzeRow(e,t){const s=[];let n=0,l=0;const a={};e.forEach(e=>{"empty"===e.type?l++:(a[e.type]=(a[e.type]||0)+1,"number"===e.type?s.push(Number(e.value)):"string"===e.type&&n++)});const r={textCount:n,emptyCount:l,dataTypes:a};if(s.length>0){const e=[...s].sort((e,t)=>e-t);Object.assign(r,{numericSum:s.reduce((e,t)=>e+t,0),numericAvg:s.reduce((e,t)=>e+t,0)/s.length,numericMin:e[0],numericMax:e[e.length-1]})}return{rowIndex:t,stats:r,trends:this.detectTrends(s),anomalies:this.detectAnomalies(s)}}static analyzeColumns(e){const t=[];for(let n=0;n<e.colCount;n++){var s;const l=[];for(let t=0;t<e.data.length;t++)l.push(e.data[t][n]);const a=this.analyzeColumn(l,n,(null===(s=e.headers)||void 0===s?void 0:s[n])||"\u5217".concat(n+1));t.push(a)}return t}static analyzeColumn(e,t,s){const n=[],l=new Set;let a=0,r=0;const i=new Set;e.forEach(e=>{"empty"===e.type||""===e.value?a++:null===e.value?r++:(n.push(e.value),l.add(String(e.value)),i.add(e.type))});const o=n.filter(e=>"number"===typeof e&&!isNaN(e)),c={unique:l.size,duplicates:n.length-l.size,empty:a,null:r};if(o.length>0){const e=[...o].sort((e,t)=>e-t),t=o.reduce((e,t)=>e+t,0)/o.length,s=o.reduce((e,s)=>e+Math.pow(s-t,2),0)/o.length;Object.assign(c,{min:e[0],max:e[e.length-1],avg:t,median:e[Math.floor(e.length/2)],std:Math.sqrt(s)})}return{colIndex:t,header:s,dataType:this.determineColumnType(i),stats:c,distribution:this.calculateDistribution(n),quality:{consistency:this.calculateConsistency(i),completeness:Math.round(n.length/e.length*100),validity:this.calculateValidity(n,i)}}}static calculateCorrelations(e){const t={},s=[];for(let a=0;a<e.colCount;a++){const t=[];for(let s=0;s<e.data.length;s++)t.push(e.data[s][a]);t.some(e=>"number"===e.type)&&s.push(a)}for(let a=0;a<s.length;a++)for(let r=a+1;r<s.length;r++){const i=s[a],o=s[r],c=[],d=[];for(let t=0;t<e.data.length;t++){const s=e.data[t][i],n=e.data[t][o];"number"===s.type&&"number"===n.type&&(c.push(Number(s.value)),d.push(Number(n.value)))}if(c.length>1){var n,l;const s=this.calculatePearsonCorrelation(c,d),a=(null===(n=e.headers)||void 0===n?void 0:n[i])||"\u5217".concat(i+1),r=(null===(l=e.headers)||void 0===l?void 0:l[o])||"\u5217".concat(o+1);t[a]||(t[a]={}),t[a][r]=s}}return t}static calculatePearsonCorrelation(e,t){const s=e.length,n=e.reduce((e,t)=>e+t,0),l=t.reduce((e,t)=>e+t,0),a=e.reduce((e,s,n)=>e+s*t[n],0),r=e.reduce((e,t)=>e+t*t,0),i=t.reduce((e,t)=>e+t*t,0),o=s*a-n*l,c=Math.sqrt((s*r-n*n)*(s*i-l*l));return 0===c?0:o/c}static detectTrends(e){if(e.length<3)return;let t=0,s=0;for(let i=1;i<e.length;i++)e[i]>e[i-1]?t++:e[i]<e[i-1]&&s++;const n=e.length-1,l=t/n,a=s/n;let r;return r=l>.7?"increasing":a>.7?"decreasing":Math.abs(l-a)<.2?"stable":"volatile",{type:r,confidence:Math.max(l,a)}}static detectAnomalies(e){if(e.length<3)return;const t=[...e].sort((e,t)=>e-t),s=t[Math.floor(.25*t.length)],n=t[Math.floor(.75*t.length)],l=n-s,a=s-1.5*l,r=n+1.5*l,i=[];return e.forEach((e,t)=>{(e<a||e>r)&&i.push(t)}),{outliers:i,missing:[]}}static calculateDistribution(e){const t={};return e.forEach(e=>{const s=String(e);t[s]=(t[s]||0)+1}),{values:t}}static determineColumnType(e){if(0===e.size)return"text";if(1===e.size){const t=Array.from(e)[0];return"number"===t?"numeric":"date"===t?"date":"boolean"===t?"boolean":"text"}return"mixed"}static calculateConsistency(e){return e.size<=1?100:Math.max(0,100-20*(e.size-1))}static calculateValidity(e,t){if(0===e.length)return 0;let s=0;return e.forEach(e=>{null!==e&&void 0!==e&&""!==e&&s++}),Math.round(s/e.length*100)}static hashRow(e){return e.map(e=>"".concat(e.address,":").concat(e.value,":").concat(e.type)).join("|")}}var x=s(4424),v=s(4414);const j=e=>{let{onAnalyzeComplete:t}=e;const{currentWorksheet:s,analysisResult:j,setAnalysisResult:f,setLoading:w}=(0,x.K)(),[A,C]=(0,n.useState)(!1),z=(0,n.useCallback)(async()=>{if(s){C(!0),w({isLoading:!0,message:"\u6b63\u5728\u5206\u6790\u6570\u636e..."});try{const e=g.analyzeWorksheet(s);f(e),null===t||void 0===t||t(e)}catch(e){console.error("\u6570\u636e\u5206\u6790\u5931\u8d25:",e)}finally{C(!1),w({isLoading:!1})}}},[s,f,w,t]);return s?(0,v.jsxs)("div",{className:"data-analysis",children:[(0,v.jsxs)("div",{style:{marginBottom:16},children:[(0,v.jsx)(h.Ay,{type:"primary",icon:(0,v.jsx)(m.A,{}),onClick:z,loading:A,children:"\u5f00\u59cb\u5206\u6790"}),j&&(0,v.jsx)(h.Ay,{icon:(0,v.jsx)(p.A,{}),onClick:z,style:{marginLeft:8},children:"\u91cd\u65b0\u5206\u6790"})]}),A&&(0,v.jsx)(l.A,{children:(0,v.jsxs)("div",{style:{textAlign:"center",padding:"40px 0"},children:[(0,v.jsx)(y.A,{size:"large"}),(0,v.jsx)("p",{style:{marginTop:16},children:"\u6b63\u5728\u5206\u6790\u6570\u636e\uff0c\u8bf7\u7a0d\u5019..."})]})}),j&&!A&&(0,v.jsxs)("div",{children:[(b=j.quality,(0,v.jsxs)(l.A,{title:"\u6570\u636e\u8d28\u91cf\u6982\u89c8",size:"small",children:[(0,v.jsxs)(a.A,{gutter:16,children:[(0,v.jsxs)(r.A,{span:6,children:[(0,v.jsx)(i.A,{title:"\u8d28\u91cf\u5206\u6570",value:b.score,suffix:"/100",valueStyle:{color:b.score>=80?"#3f8600":(b.score,"#cf1322")}}),(0,v.jsx)(o.A,{percent:b.score,strokeColor:b.score>=80?"#52c41a":b.score>=60?"#faad14":"#ff4d4f",size:"small"})]}),(0,v.jsx)(r.A,{span:6,children:(0,v.jsx)(i.A,{title:"\u603b\u884c\u6570",value:b.summary.totalRows})}),(0,v.jsx)(r.A,{span:6,children:(0,v.jsx)(i.A,{title:"\u603b\u5217\u6570",value:b.summary.totalCols})}),(0,v.jsx)(r.A,{span:6,children:(0,v.jsx)(i.A,{title:"\u7a7a\u503c\u6570\u91cf",value:b.summary.emptyCells})})]}),b.issues.length>0&&(0,v.jsxs)("div",{style:{marginTop:16},children:[(0,v.jsx)("h4",{children:"\u8d28\u91cf\u95ee\u9898"}),b.issues.slice(0,5).map((e,t)=>(0,v.jsx)(c.A,{message:e.message,type:"high"===e.severity?"error":"medium"===e.severity?"warning":"info",style:{marginBottom:8}},t)),b.issues.length>5&&(0,v.jsx)("div",{style:{textAlign:"center",marginTop:8},children:(0,v.jsxs)("small",{children:["\u8fd8\u6709 ",b.issues.length-5," \u4e2a\u95ee\u9898..."]})})]})]})),(0,v.jsxs)(a.A,{gutter:16,style:{marginTop:16},children:[(0,v.jsx)(r.A,{span:12,children:(e=>{const t=[{title:"\u884c\u53f7",dataIndex:"rowIndex",key:"rowIndex",render:e=>e+1,width:80},{title:"\u6570\u503c\u7edf\u8ba1",key:"numericStats",render:e=>{const{numericSum:t,numericAvg:s,numericMin:n,numericMax:l}=e.stats;return void 0===t?(0,v.jsx)(d.A,{color:"default",children:"\u65e0\u6570\u503c"}):(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{children:["\u603b\u548c: ",null===t||void 0===t?void 0:t.toFixed(2)]}),(0,v.jsxs)("div",{children:["\u5e73\u5747: ",null===s||void 0===s?void 0:s.toFixed(2)]}),(0,v.jsxs)("div",{children:["\u8303\u56f4: ",n," ~ ",l]})]})}},{title:"\u6570\u636e\u7c7b\u578b",key:"dataTypes",render:e=>(0,v.jsx)("div",{children:Object.entries(e.stats.dataTypes).map(e=>{let[t,s]=e;return(0,v.jsxs)(d.A,{color:"blue",children:[t,": ",s]},t)})})},{title:"\u8d8b\u52bf",key:"trends",render:e=>{if(!e.trends)return(0,v.jsx)(d.A,{color:"default",children:"\u65e0\u8d8b\u52bf"});const t="increasing"===e.trends.type?"green":"decreasing"===e.trends.type?"red":"stable"===e.trends.type?"blue":"orange";return(0,v.jsxs)(d.A,{color:t,children:[e.trends.type," (",Math.round(100*e.trends.confidence),"%)"]})}},{title:"\u5f02\u5e38\u503c",key:"anomalies",render:e=>e.anomalies&&0!==e.anomalies.outliers.length?(0,v.jsxs)(d.A,{color:"red",children:[e.anomalies.outliers.length," \u4e2a\u5f02\u5e38"]}):(0,v.jsx)(d.A,{color:"green",children:"\u6b63\u5e38"})}];return(0,v.jsxs)(l.A,{title:"\u884c\u6570\u636e\u5206\u6790",size:"small",children:[(0,v.jsx)(u.A,{columns:t,dataSource:e.slice(0,20),pagination:{pageSize:10},size:"small",scroll:{x:600}}),e.length>20&&(0,v.jsx)("div",{style:{textAlign:"center",marginTop:8},children:(0,v.jsxs)("small",{children:["\u663e\u793a\u524d20\u884c\uff0c\u5171 ",e.length," \u884c\u6570\u636e"]})})]})})(j.rows)}),(0,v.jsx)(r.A,{span:12,children:(e=>{const t=[{title:"\u5217\u540d",dataIndex:"header",key:"header",width:120},{title:"\u6570\u636e\u7c7b\u578b",dataIndex:"dataType",key:"dataType",render:e=>{const t="numeric"===e?"green":"text"===e?"blue":"date"===e?"purple":"boolean"===e?"orange":"red";return(0,v.jsx)(d.A,{color:t,children:e})}},{title:"\u7edf\u8ba1\u4fe1\u606f",key:"stats",render:e=>{const{unique:t,duplicates:s,empty:n,min:l,max:a,avg:r}=e.stats;return(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{children:["\u552f\u4e00\u503c: ",t]}),(0,v.jsxs)("div",{children:["\u91cd\u590d\u503c: ",s]}),(0,v.jsxs)("div",{children:["\u7a7a\u503c: ",n]}),void 0!==l&&(0,v.jsxs)("div",{children:["\u8303\u56f4: ",l," ~ ",a]}),void 0!==r&&(0,v.jsxs)("div",{children:["\u5e73\u5747: ",r.toFixed(2)]})]})}},{title:"\u6570\u636e\u8d28\u91cf",key:"quality",render:e=>(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{children:["\u4e00\u81f4\u6027: ",e.quality.consistency,"%"]}),(0,v.jsxs)("div",{children:["\u5b8c\u6574\u6027: ",e.quality.completeness,"%"]}),(0,v.jsxs)("div",{children:["\u6709\u6548\u6027: ",e.quality.validity,"%"]})]})}];return(0,v.jsx)(l.A,{title:"\u5217\u6570\u636e\u5206\u6790",size:"small",children:(0,v.jsx)(u.A,{columns:t,dataSource:e,pagination:{pageSize:10},size:"small",scroll:{x:600}})})})(j.columns)})]})]})]}):(0,v.jsx)(l.A,{children:(0,v.jsxs)("div",{style:{textAlign:"center",padding:"40px 0"},children:[(0,v.jsx)(m.A,{style:{fontSize:"48px",color:"#ccc"}}),(0,v.jsx)("p",{style:{marginTop:16,color:"#999"},children:"\u8bf7\u5148\u4e0a\u4f20Excel\u6587\u4ef6"})]})});var b}}}]);